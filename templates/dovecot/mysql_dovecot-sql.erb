#BEGIN /etc/dovecot/dovecot-sql.conf
#
#  MANAGED BY PUPPET
#     do not edit this file manualy
#

driver = mysql

# mysql:
#  host, port, user, password, dbname
# 
#   But also adds some new settings:
#     client_flags        - See MySQL manual
#     ssl_ca, ssl_ca_path - Set either one or both to enable SSL
#     ssl_cert, ssl_key   - For sending client-side certificates to server
#     ssl_cipher          - Set minimum allowed cipher security (default: HIGH)
#     option_file         - Read options from the given file instead of
#                           the default my.cnf location
#     option_group        - Read options from the given group (default: client)
# 
#   You can connect to UNIX sockets by using host: host=/var/run/mysql.sock
#   Note that currently you can't use spaces in parameters.
#
#
connect = host=<%= @host %> \
          dbname=<%= @dbname %> \
	  user=<%= @dbuser %> \
	  password=<%= @dbpass %> <% if @mysql_flags != [] %>\<% end %>
          <%= @mysql_flags.join(" \\\n") %>

# Default password scheme - change to match your Postfixadmin setting.
# depends on your $CONF['encrypt'] setting:
# md5crypt  -> MD5-CRYPT
# md5       -> PLAIN-MD5
# cleartext -> PLAIN
#
default_pass_scheme = <%= @default_password_scheme %>

# Query to retrieve password. user can be used to retrieve username in other
# formats also.
#
password_query = SELECT username AS user,password FROM mailbox WHERE username = '%u' AND active='1'

user_query = SELECT \
<% if @mboxpath -%>
	       CONCAT('<%= @mboxpath %>', maildir) AS home, \
<% else -%>
	       maildir AS home, \
<% end -%>
<% if @uid -%>
	       <%= @uid %> AS uid, \
<% end -%>
<% if @gid -%>
	       <%= @gid %> AS gid, \
<% end -%>
<% if @quota -%>
	       CONCAT('*:bytes=', quota) AS quota_rule \
<% end -%>
	     FROM mailbox \
	       WHERE username = '%u' \
	         AND active   = '1'

# Query to get a list of all usernames.
iterate_query = SELECT username AS user FROM mailbox WHERE active='1'

#END /etc/dovecot/dovecot-sql.conf
